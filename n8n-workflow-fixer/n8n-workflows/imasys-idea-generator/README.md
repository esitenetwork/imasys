# イマシスアイデア発掘システム

## 🎯 プロジェクトの目的
イマシスアイデア発掘システムは、n8nワークフローを使用してアイデアを自動生成し、詳細なMDXコンテンツを作成してデータベースに保存するシステムです。

## ✅ 最新状況（2025年7月21日）
**テスト環境での動作確認が完了しました！**

### 動作確認済みワークフロー
- **ファイル**: `imasys-idea-generator-optimized.json`
- **状態**: テスト環境で正常動作
- **機能**: アイデア生成、MDXコンテンツ作成、データベース保存

## 🏗️ プロジェクト構成

### コアファイル
- `imasys-idea-generator-optimized.json` - 動作中のワークフロー
- `ideas_rows.sql` - 本番データ構造（3,000文字のMDX）
- `README.md` - このファイル（詳細ドキュメント）

## 🔧 システム概要

### ワークフロー構成
1. **Webhook Trigger** - ワークフロー開始
2. **Parse Parameters** - パラメータ解析
3. **Google Sheets** - 既存データ取得
4. **Efficient Filter** - データフィルタリング
5. **ChatGPT API** - アイデア生成
6. **Parse and Check** - レスポンス解析
7. **Claude API** - MDX生成
8. **Parse Claude** - MDX解析
9. **Save to Supabase** - データ保存

### データ構造
**テーブル**: `ideas`
- `id` - 主キー
- `title` - タイトル
- `category` - カテゴリ
- `tags` - タグ
- `price_range` - 価格帯
- `duration` - 期間
- `source` - ソース
- `status` - ステータス
- `slug` - URLスラッグ
- `notes` - メモ
- `mdx_content` - MDXコンテンツ（3,000文字）
- `created_at` - 作成日時
- `updated_at` - 更新日時

## 📊 現在の成果

### 修正完了項目
1. **Codeノードの入力データアクセス修正**
   - 問題: `$node["Google Sheets"].all()` の誤用
   - 解決: `$input.all()` に変更

2. **入力データ存在チェック追加**
   - 問題: データが存在しない場合のエラー
   - 解決: 各Codeノードに存在チェックを追加

3. **Claude API認証修正**
   - 問題: APIキーの参照方法が間違っている
   - 解決: `={{ $credentials.claudeApiKey.apiKey }}` に変更

4. **Supabaseノードパラメータ修正**
   - 問題: `table` → `tableId`、`insert` → `create`
   - 解決: 正しいパラメータ名に変更

5. **データベース保存機能の実装**
   - 問題: データベース制約エラー
   - 解決: 実際のAPIレスポンス解析とデータベース保存機能を実装

### 成功要因
1. **段階的な修正**: 一度に複数の問題を修正せず、一つずつ解決
2. **ソースコード確認**: n8nのソースコードを参照して正確なパラメータを特定
3. **ユーザー連携**: 修正→更新→実行のサイクルを確立
4. **エラーハンドリング**: 包括的なエラー処理とデバッグ機能

## 🚀 次のステップ

### 1. 本番データ登録テスト（優先）
**目的**: 現在のワークフローが3,000文字のMDXを生成できるか確認

**必要な修正**:
- MDX生成部分の大幅拡張（現在200文字→目標3,000文字）
- 文字数配分の実装:
  - 概要・課題 (300文字)
  - 解決策・システム (400文字)
  - 主な機能 (1200文字)
  - 導入効果 (500文字)
  - 料金プラン (300文字)
  - 導入事例 (300文字)
  - 連携ツール (200文字)
  - よくある質問 (200文字)

**確認項目**:
- 本番データベースへの登録
- エラーハンドリング
- パフォーマンステスト

### 2. 管理画面（UI）との連携
**目的**: 別プロジェクトフォルダでの管理画面開発

**準備項目**:
- API仕様の整理
- データ形式の標準化
- 外部連携用のインターフェース定義

## 🎯 プロジェクトの真の目的
**イマシスアイデア発掘システム**: アイデアを自動生成し、詳細なMDXコンテンツを作成してデータベースに保存するシステム

## 📚 参考資料

- `ideas_rows.sql` - 本番データ構造（3,000文字のMDX例）

## 🔄 プロジェクトの転換経緯

### 元プロジェクト
- **名称**: n8n Workflow Fixer CLI Tool
- **目的**: 汎用的なn8nワークフロー修正ツール
- **結果**: 技術的限界により断念

### 新プロジェクト
- **名称**: イマシスアイデア発掘システム
- **目的**: 特定のワークフロー（アイデア生成）に特化
- **結果**: テスト環境での動作確認完了

### 転換理由
- 汎用ツールよりも特化したソリューションの方が効果的
- 実際のニーズに合致したシステムの構築
- リソース配分の最適化

### 断念理由（詳細）
1. **n8n API制限**: ワークフローのアクティブ化がAPI経由で不可
2. **エラー解析の複雑性**: n8nのエラーメッセージが多様で解析困難
3. **ワークフロー構造の多様性**: ノード構成や設定がワークフローごとに大きく異なる
4. **プロジェクト方向性の転換**: 汎用ツールよりも特化したソリューションの方が効果的

## 🛠️ 開発ツール・ライブラリ

### 現在使用中のツール
- **n8n**: ワークフロー実行エンジン
- **ChatGPT API**: アイデア生成
- **Claude API**: MDXコンテンツ生成
- **Supabase**: データベース
- **Google Sheets**: データソース

## 📊 品質管理

### 現在のチェックリスト
- [x] テスト環境での動作確認
- [x] 基本的なワークフロー修正
- [x] プロジェクト構造の整理
- [x] ドキュメントの統合
- [ ] 本番データ登録テスト
- [ ] MDX生成部分の3,000文字対応
- [ ] 管理画面連携の準備

## 🎯 今後の展開

### 短期目標
- 本番データ登録テストの完了
- MDX生成品質の向上
- 管理画面連携の準備

### 中期目標
- 管理画面との連携実装
- システムの安定化
- 運用監視の強化

### 長期目標
- システムの拡張
- 新機能の追加
- 運用効率の向上

## 🤝 次のセッションへの引き継ぎ

### 現在の状況
- テスト環境での動作確認完了
- 本番データ登録テストの準備完了
- プロジェクト構造の整理完了
- ドキュメントの適切な配置完了

### 次の作業
1. MDX生成部分の3,000文字対応
2. 本番データ登録テストの実行
3. 管理画面連携の準備

### 重要なファイル
- `imasys-idea-generator-optimized.json` - 動作中のワークフロー
- `ideas_rows.sql` - 本番データ構造（3,000文字のMDX） 