# 新規事業「今どきシステム導入ラボ」サイト構成・仕様書

日付: 2025年7月6日  
バージョン: 2.2  
更新者: Claude

## 基本情報

- **サイト名**: 今どきシステム導入ラボ「イマシス」
- **英語表記**: IMASYS
- **ドメイン**: imasys.jp
- **ドメイン所有**: お名前.com
- **DNS管理**: Cloudflare
- **本番URL**: https://imasys.jp
- **開発確認用URL**: https://imasys-jp.vercel.app

## 1. 技術スタック

### フロントエンド
- **フレームワーク**: Next.js 15.3.4 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **UIライブラリ**: shadcn/ui（予定）

### バックエンド・データベース
- **データベース**: Supabase（PostgreSQL）
- **認証**: Supabase Auth（将来実装予定）
- **APIルート**: Next.js API Routes

### インフラ・外部サービス
- **ホスティング**: Vercel（Pro Plan）
- **メール送信**: Resend（実装済み）
- **画像管理**: Cloudinary（予定）
- **データ連携**: Google Sheets API（実装済み）
- **reCAPTCHA**: Google reCAPTCHA v2（実装済み）

## 2. サイトコンセプト

GitHubやn8n、Zapierなどで公開されている実装例を参考に、中小企業向けの「AI業務改善アイデア」を視覚的に探索できる**アイデア・ギャラリー**サイト

**目標**: 1,000個のアイデアを掲載（競合への抑止力）

## 3. データ管理アーキテクチャ

```
ChatGPT（アイデア発掘・重複チェック）
    ↓
Google Sheets（重複チェック用マスター管理）
    ↓
Claude（MDXコンテンツ作成）
    ↓
管理画面（MDXペースト・自動解析）
    ↓
Supabase（メインデータベース）
    ↓ クライアントサイド同期
Google Sheets（同期・バックアップ）
    ↓
Next.js（表示・配信）
```

### データフロー詳細
1. **アイデア発掘**: ChatGPTがGoogle Sheetsを確認して重複のないアイデアを発掘
2. **MDX作成**: Claude（AI）がアイデアをMDX形式で作成
3. **登録**: 管理画面でMDXをペースト、フロントマター自動解析
4. **保存**: Supabaseにアイデアデータを保存
5. **同期**: クライアントサイドで自動的にGoogle Sheetsに同期
6. **配信**: Next.jsがSupabaseからデータを取得して表示

## 4. ページ構成

### 公開ページ

#### トップページ（アイデア・ギャラリー）
- **パス**: `/`
- **機能**: 
  - カード形式でアイデアをグリッド表示
  - 左サイドバーでフィルタリング（未実装）
  - カテゴリ・タグでの絞り込み（一部実装）
- **データソース**: Supabase

#### アイデア詳細ページ
- **パス**: `/ideas/[slug]`
- **機能**: 
  - 課題と解決策の説明
  - 実装イメージ（図解）
  - 価格・納期目安
  - 「このアイデアで相談する」CTA
- **データソース**: Supabase

#### お問い合わせページ
- **パス**: `/contact`
- **機能**:
  - 動的フォーム（件名によるカテゴリ変更）
  - システム詳細ページからの自動入力
  - Google reCAPTCHA v2による認証
  - Resendによるメール送信
- **実装状況**: 完了

#### Aboutページ
- **パス**: `/about`
- **機能**: 企業・サービス紹介
- **実装状況**: 完了

### 管理画面

#### ダッシュボード
- **パス**: `/admin`
- **機能**: 統計情報表示

#### アイデア管理
- **一覧**: `/admin/ideas`
- **新規追加**: `/admin/ideas/new`
- **編集**: `/admin/ideas/[slug]/edit`
- **特徴**: 2カラムレイアウト（MDX編集 + メタ情報）
- **MDX自動解析**: フロントマター自動反映機能

#### 連携機能
- **Google Sheets連携**: `/admin/sheets`
- **同期管理**: `/admin/sync`（手動同期・自動同期）
- **インポート**: `/admin/import`（MDXインポート）

## 5. データベース設計

### ideasテーブル

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | SERIAL | 主キー |
| created_at | TIMESTAMP | 作成日時 |
| title | TEXT | タイトル |
| category | TEXT | カテゴリ |
| tags | TEXT | タグ（カンマ区切り） |
| price_range | TEXT | 価格帯 |
| duration | TEXT | 構築期間 |
| source | TEXT | 元ネタ（内部用） |
| status | TEXT | ステータス（draft/published/archived） |
| slug | TEXT | URL用スラッグ（ユニーク） |
| notes | TEXT | 備考 |
| mdx_content | TEXT | MDXコンテンツ |
| updated_at | TIMESTAMP | 更新日時 |

### インデックス
- slug（高速検索用）
- status（フィルタリング用）
- category（フィルタリング用）

## 6. カテゴリ・タグ体系

### メインカテゴリ
- 営業・販売
- 経理・会計
- 在庫・物流
- 顧客管理
- マーケティング
- 人事・労務
- 製造・生産
- カスタマーサポート

### タグ例
- 実装の特徴: #AI活用、#自動化、#リアルタイム
- 連携ツール: #LINE連携、#Slack連携、#Gmail連携
- 導入効果: #5分で完了、#毎日1時間削減
- 価格帯: #10万円以下、#30万円以下

## 7. API設計

### 実装済みAPI
- `GET /api/admin/ideas` - アイデア一覧取得（Supabase）
- `POST /api/admin/ideas` - 新規アイデア追加（Supabase）
- `PUT /api/admin/ideas` - アイデア更新（Supabase）
- `POST /api/sync` - Google Sheets ⇄ Supabase 同期処理
- `GET /api/sync` - 同期状況確認
- `POST /api/contact` - お問い合わせ送信（Resend）

### 同期処理の詳細
- **手動同期**: `/admin/sync` 画面からの操作
- **自動同期**: アイデア保存後にクライアントサイドから `/api/sync` を呼び出し
- **同期方向**: 
  - `supabase-to-sheets`: Supabase → Google Sheets
  - `sheets-to-supabase`: Google Sheets → Supabase
- **削除同期**: アイデア削除時も自動でGoogle Sheetsから削除

### 予定API
- `GET /api/ideas` - 公開用アイデア取得
- `GET /api/ideas/[slug]` - 個別アイデア取得
- `POST /api/ideas/search` - 検索・フィルタリング

## 8. デプロイ・開発フロー

### 2段階デプロイ体制

#### 開発環境
- **ブランチ**: `develop`
- **URL**: https://imasys-jp.vercel.app
- **用途**: 機能テスト・動作確認

#### 本番環境
- **ブランチ**: `main`
- **URL**: https://imasys.jp
- **用途**: 一般公開

### 開発フロー
```
1. developブランチで開発・修正
2. コミット・プッシュ
3. https://imasys-jp.vercel.app で動作確認
4. 問題なければPull Request作成
5. mainブランチにマージ
6. https://imasys.jp に自動反映
```

### デプロイコマンド
```bash
# 開発環境への反映
git checkout develop
git add .
git commit -m "機能説明"
git push origin develop

# 本番環境への反映
git checkout main
git merge develop
git push origin main
```

### 便利なバッチファイル
- `deploy.bat`: 日時付きコミットで本番デプロイ
- `gitpull.bat`: 開発開始時の更新

## 9. 環境変数

### Supabase
```
NEXT_PUBLIC_SUPABASE_URL=https://rzydussozubiylwoletp.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[匿名キー]
SUPABASE_SERVICE_ROLE_KEY=[サービスロールキー]
SUPABASE_DB_PASSWORD=AYOQPNQMr7qMgyqw
```

### Google Sheets API
```
GOOGLE_SHEETS_ID=12zYI6DhYg1Yw6xCw2cbBifwFu4_iMsql9DuNMXPN4DI
GOOGLE_SERVICE_ACCOUNT_EMAIL=imasys-sheets-api-v2@imasys.iam.gserviceaccount.com
GOOGLE_PRIVATE_KEY=[秘密鍵]
```

### メール送信（Resend）
```
RESEND_API_KEY=[APIキー]
```

### reCAPTCHA
```
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=[サイトキー]
RECAPTCHA_SECRET_KEY=[シークレットキー]
```

## 10. セキュリティ

### 実装済み
- 環境変数での認証情報管理
- Row Level Security (RLS) 設定
- Service Roleでの管理画面アクセス
- Google reCAPTCHA v2によるスパム対策

### 予定
- 管理画面の認証実装
- CSRF対策
- レート制限

## 11. パフォーマンス最適化

### 実装済み
- Supabaseによる高速データ取得
- 適切なインデックス設定
- Next.js App Routerのキャッシュ機能
- Google Sheets ⇄ Supabase双方向同期

### 予定
- 画像の最適化（Cloudinary）
- 静的生成（SSG）の活用
- Edge Functionsの活用

## 12. 実装済み機能

### 完了機能
- ✅ アイデア・ギャラリー（トップページ）
- ✅ 管理画面（新規作成・編集・同期）
- ✅ Google Sheets ⇄ Supabase 双方向同期
- ✅ MDX自動解析機能（フロントマター解析）
- ✅ お問い合わせフォーム（Resend連携）
- ✅ Google reCAPTCHA v2実装
- ✅ 2段階デプロイ体制
- ✅ 本番環境・開発環境の運用
- ✅ SEO最適化（メタデータ・構造化データ）
- ✅ Aboutページ

### 進行中
- 🔄 残りアイデアの追加（目標1,000件）

## 13. 将来的な拡張（新規追加）

### Claudeチャットボット相談機能

#### 13.1 機能概要
- **目的**: 24時間対応の自動相談システム
- **対象**: システム導入を検討している見込み客
- **価値提案**: リアルタイムでの導入相談・アドバイス

#### 13.2 技術仕様

##### フロントエンド
- **UI**: 右下固定のチャットウィジェット
- **ライブラリ**: 検討中（React Chat UI / Custom Component）
- **レスポンシブ**: モバイル・デスクトップ対応

##### バックエンド・API
- **Claude API**: Anthropic Claude API連携
- **エンドポイント**: `/api/chat`
- **認証**: API Key管理
- **レート制限**: ユーザーごとの制限設定

##### データベース
- **会話履歴**: Supabaseに保存（オプション）
- **ユーザーセッション**: セッション管理
- **分析データ**: 相談内容の傾向分析

#### 13.3 機能詳細

##### チャットボットの役割
1. **初期対応**: 基本的な質問への自動回答
2. **アイデア提案**: 業務課題に基づくシステムアイデア提案
3. **見積もり概算**: 概算の期間・費用アドバイス
4. **問い合わせ誘導**: 詳細相談への適切な誘導

##### 想定対話フロー
```
1. 挨拶・目的確認
2. 業務課題のヒアリング
3. 関連アイデアの提案
4. 概算見積もり・期間の案内
5. 詳細相談への誘導
```

#### 13.4 実装段階

##### Phase 1: 基本チャット機能
- Claude API連携
- シンプルなUI実装
- 基本的な質問対応

##### Phase 2: 高度な相談機能
- アイデア・ギャラリーとの連携
- 個別提案機能
- 会話履歴の保存

##### Phase 3: 分析・改善
- 相談データの分析
- 回答精度の向上
- A/Bテスト実施

#### 13.5 期待効果
- **24時間対応**: 営業時間外の見込み客対応
- **工数削減**: 初期相談の自動化
- **データ収集**: 顧客ニーズの把握
- **体験価値**: AI技術の実体験による啓発

#### 13.6 必要な環境変数
```
ANTHROPIC_API_KEY=[Claude APIキー]
CHAT_RATE_LIMIT=[レート制限設定]
CHAT_SESSION_TIMEOUT=[セッションタイムアウト]
```

#### 13.7 セキュリティ考慮事項
- API Key の適切な管理
- レート制限による悪用防止
- 会話データの適切な取り扱い
- プライバシー保護

## 14. 開発ガイドライン

### コーディング規約
- TypeScriptの厳格な型定義
- ESLintルールの遵守
- コンポーネントの適切な分割

### Git運用
- 2段階デプロイ体制（develop → main）
- コミットメッセージは日本語可
- Pull Request経由での本番反映

### デプロイ
- GitHubへのプッシュで自動デプロイ（Vercel）
- 環境変数はVercelダッシュボードで管理
- 開発環境での確認後に本番反映

---

更新履歴:
- v2.2 (2025/07/06): Claudeチャットボット相談機能の仕様追加
- v2.1 (2025/07/06): 2段階デプロイ体制追加、お問い合わせフォーム完了、reCAPTCHA実装
- v2.0 (2025/01/03): Supabase導入、管理画面機能拡充
- v1.0 (2025/06/30): 初版作成